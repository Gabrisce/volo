{% extends 'layout/base.html' %}
{% block title %}Le mie campagne{% endblock %}

{% block content %}
<div class="container-xxl">

  <div class="d-flex align-items-center justify-content-between flex-wrap gap-2 mb-3">
    <h2 class="mb-0">{{ _('Le mie campagne') }}</h2>
    <a href="{{ url_for('campaigns.create_campaign') }}" class="btn-ghost-brand btn-ghost-sm rounded-pill">
      <i class="bi bi-plus-lg me-1"></i>{{ _('Crea nuova campagna') }}
    </a>
  </div>

  {# -- riferimento all'orario corrente passato dalla route -- #}
  {% set now = namespace(value=current_time) %}

  {# ==================== CAMPAGNE ATTIVE ==================== #}
  <div class="mb-3">
    <h5 class="mb-2 d-flex align-items-center gap-2">
      <i class="bi bi-lightning-charge"></i> {{ _('Campagne attive') }}
    </h5>
   
    {# ---- CAMPAGNE ATTIVE ---- #}
{% set active = namespace(found=False) %}
<div class="row g-3">
  {% for campaign in campaigns %}
    {% set ended = campaign.end_date is not none and campaign.end_date < now.value %}
    {% if not ended %}
      {% set active.found = True %}
          {% set cid = 'campaign-' ~ campaign.id %}
          <div class="col-md-6 col-lg-4">
            <div class="card h-100 shadow-sm">
              {% if campaign.image_filename %}
                <img src="{{ url_for('campaigns.static', filename='uploads/campaigns/' ~ campaign.image_filename) }}"
                     class="card-img-top" alt="Immagine campagna" style="object-fit:cover; height:180px;">
              {% else %}
                <div class="d-flex align-items-center justify-content-center bg-light" style="height:180px;">
                  <span class="text-muted">{{ _('Nessuna immagine') }}</span>
                </div>
              {% endif %}

              <div class="card-body position-relative d-flex flex-column">
                {# Azioni visibili SOLO per campagne attive #}
                <div class="post-actions">
                  <a href="{{ url_for('campaigns.edit_campaign', campaign_id=campaign.id) }}"
                     class="icon-btn" title="{{ _('Modifica') }}" aria-label="{{ _('Modifica campagna') }}">
                    <i class="bi bi-pencil-square"></i>
                  </a>
                  <form action="{{ url_for('campaigns.delete_campaign', campaign_id=campaign.id) }}"
                        method="POST" class="icon-btn-form"
                        onsubmit="return confirm('Sei sicuro di voler eliminare questa campagna?');">
                    <button type="submit" class="icon-btn danger" title="{{ _('Elimina') }}" aria-label="{{ _('Elimina campagna') }}">
                      <i class="bi bi-trash"></i>
                    </button>
                  </form>
                </div>

                <h5 class="card-title pe-5 mb-2">
                  <a href="{{ url_for('public.detail', content_type='campaign', item_id=campaign.id) }}"
                     class="text-decoration-none text-dark">{{ campaign.title }}</a>
                </h5>

                <p class="card-text mb-1">
                  <small class="text-muted">
                    {% if campaign.date %}
                      üìÖ {{ _('Inizio:') }} {{ campaign.date.strftime('%d/%m/%Y') }}
                      {% if campaign.end_date %} ‚Äî {{ _('Fine:') }} {{ campaign.end_date.strftime('%d/%m/%Y') }}{% endif %}
                      <br>
                    {% endif %}
                    üìç {{ campaign.location or _('Luogo non specificato') }}
                  </small>
                </p>

                {% if campaign.goal_amount %}
                  <p class="card-text mb-2">
                    <small class="text-muted">üéØ {{ _('Obiettivo:') }} ‚Ç¨{{ campaign.goal_amount }}</small>
                  </p>
                {% endif %}

              
              </div>
            </div>
          </div>
         {% endif %}
  {% endfor %}
</div>
{% if not active.found %}
  <div class="alert alert-light mt-2 mb-0">{{ _('Nessuna campagna attiva.') }}</div>
{% endif %}
  </div>

  {# ==================== CAMPAGNE PASSATE ==================== #}
  <div class="mt-4">
    <h5 class="mb-2 d-flex align-items-center gap-2">
      <i class="bi bi-clock-history"></i> {{ _('Campagne passate') }}
    </h5>

    {# ---- CAMPAGNE PASSATE ---- #}
{% set past = namespace(found=False) %}
<div class="row g-3">
  {% for campaign in campaigns %}
    {% set ended = campaign.end_date is not none and campaign.end_date < now.value %}
    {% if ended %}
      {% set past.found = True %}
          {% set cid = 'campaign-' ~ campaign.id %}
          <div class="col-md-6 col-lg-4">
            <div class="card h-100 shadow-sm">
              {% if campaign.image_filename %}
                <img src="{{ url_for('campaigns.static', filename='uploads/campaigns/' ~ campaign.image_filename) }}"
                     class="card-img-top" alt="Immagine campagna" style="object-fit:cover; height:180px;">
              {% else %}
                <div class="d-flex align-items-center justify-content-center bg-light" style="height:180px;">
                  <span class="text-muted">{{ _('Nessuna immagine') }}</span>
                </div>
              {% endif %}

              <div class="card-body position-relative d-flex flex-column">
                {# ‚ö†Ô∏è Nessuna azione di modifica/eliminazione per le passate #}

                <h5 class="card-title mb-2">
                  <a href="{{ url_for('public.detail', content_type='campaign', item_id=campaign.id) }}"
                     class="text-decoration-none text-dark">{{ campaign.title }}</a>
                </h5>

                <p class="card-text mb-1">
                  <small class="text-muted">
                    {% if campaign.date %}
                      üìÖ {{ _('Inizio:') }} {{ campaign.date.strftime('%d/%m/%Y') }}
                      {% if campaign.end_date %} ‚Äî {{ _('Fine:') }} {{ campaign.end_date.strftime('%d/%m/%Y') }}{% endif %}
                      <br>
                    {% endif %}
                    üìç {{ campaign.location or _('Luogo non specificato') }}
                  </small>
                </p>

                {% if campaign.goal_amount %}
                  <p class="card-text mb-2">
                    <small class="text-muted">üéØ {{ _('Obiettivo:') }} ‚Ç¨{{ campaign.goal_amount }}</small>
                  </p>
                {% endif %}
              </div>
            </div>
          </div>
        {% endif %}
  {% endfor %}
</div>
{% if not past.found %}
  <div class="alert alert-light mt-2 mb-0">{{ _('Non ci sono campagne passate.') }}</div>
{% endif %}
  </div>

</div>
{% endblock %}

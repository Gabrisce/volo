{% extends 'layout/base.html' %}
{% block title %}Donazione completata{% endblock %}

{% block content %}
<div class="container my-5 text-center">
  <h2 class="text-success" role="status" aria-live="polite">‚úÖ {{ _('Grazie per la tua donazione!') }}</h2>
  <p class="mt-2">
    {{ _('Hai contribuito alla campagna') }}
    <strong>{{ donation.campaign.title }}</strong>
    {{ _('con') }} ‚Ç¨{{ donation.amount }}.
  </p>

  {% if donation.pdf_filename %}
    {# preferisci l'URL gi√† calcolato nel controller; fallback alla route di download #}
    {% set href_receipt = receipt_url or url_for('payments.download_receipt', filename=donation.pdf_filename) %}

    <div class="mt-4 d-flex justify-content-center gap-2">
      <a
        href="{{ href_receipt }}"
        class="btn btn-primary"
        target="_blank"
        rel="noopener"
        aria-label="Apri la ricevuta della donazione in una nuova scheda"
      >
        üìÑ {{ _('Apri ricevuta PDF') }}
      </a>
      <a
        href="{{ href_receipt }}"
        class="btn btn-outline-secondary"
        download
        aria-label="Scarica la ricevuta della donazione in PDF"
      >
        ‚¨áÔ∏è {{ _('Scarica PDF') }}
      </a>
    </div>
  {% else %}
    <p class="text-muted mt-3">{{ _('La ricevuta non √® al momento disponibile.') }}</p>
  {% endif %}

  {% if related_events %}
  <hr>
  <h5 class="mt-4">Partecipa ai prossimi eventi di {{ donation.campaign.association.name }}</h5>
  <div class="list-group">
    {% for e in related_events %}
      <a href="{{ url_for('events.event_detail', event_id=e.id) }}" class="list-group-item list-group-item-action">
        <strong>{{ e.title }}</strong><br>
        <small>{{ e.date.strftime('%d/%m/%Y') }} ‚Äì {{ e.location }}</small>
      </a>
    {% endfor %}
  </div>
  {% endif %}


  <div class="mt-4">
    <a href="{{ url_for('campaigns.campaign_detail', campaign_id=donation.campaign_id) }}" class="btn btn-link">
      ‚Üê {{ _('Torna alla campagna') }}
    </a>
  </div>
</div>
{% endblock %}

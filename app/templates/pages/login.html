{% extends 'layout/base.html' %}
{% block title %}Login{% endblock %}
{% block container_class %}container-sm{% endblock %}
{% block navbar_auth %}{% endblock %}

{% block content %}
<div class="d-flex justify-content-center align-items-center" style="min-height:85vh;">
  <div class="card shadow-sm border-0 login-card">
    <div class="card-body p-4">

      <!-- Header -->
      <div class="text-center mb-4">
        <h4 class="fw-bold mb-1">{{ _('Accedi a') }} <span class="brand-text">Volò</span></h4>
        <p class="text-body-secondary small">{{ _('Inserisci le tue credenziali per continuare') }}</p>
      </div>

      <!-- ===== FORM LOGIN ===== -->
      <div id="loginForm">
        <form method="POST" novalidate>
          {{ form.hidden_tag() }}

          <!-- Email -->
          <div class="mb-3">
            {{ form.email.label(class="form-label small fw-semibold") }}
            {{ form.email(class="form-control form-control-sm", placeholder="email@example.com", required=True) }}
            {% for error in form.email.errors %}
              <div class="text-danger small">{{ error }}</div>
            {% endfor %}
          </div>

          <!-- Password -->
          <div class="mb-3">
            {{ form.password.label(class="form-label small fw-semibold") }}
            <div class="input-group input-group-sm">
              {{ form.password(class="form-control", id="loginPassword", placeholder="Password", required=True) }}
              <button type="button" class="btn icon-btn ghost" id="togglePassword" title="{{ _('Mostra password') }}">
                <i class="bi bi-eye"></i>
              </button>
            </div>
            {% for error in form.password.errors %}
              <div class="text-danger small">{{ error }}</div>
            {% endfor %}
          </div>

          <!-- Opzioni -->
          <div class="d-flex justify-content-between align-items-center mb-3">
            <div class="form-check">
              <input type="checkbox" class="form-check-input" id="rememberMe" name="remember">
              <label for="rememberMe" class="form-check-label small">{{ _('Ricordami') }}</label>
            </div>
            <a href="#" id="forgotPasswordLink" class="small link-like">{{ _('Password dimenticata?') }}</a>
          </div>

          <!-- Submit -->
          <div class="d-grid">
            {{ form.submit(class="btn btn-primary fw-semibold") }}
          </div>
        </form>
      </div>

      <!-- ===== FORM RESET ===== -->
      <div id="resetForm" class="d-none">
        <form method="POST" action="{{ url_for('auth.reset_password') }}" novalidate>
          <div class="mb-3">
            <label for="resetEmail" class="form-label small fw-semibold">{{ _('Email di registrazione') }}</label>
            <input type="email" id="resetEmail" name="email" class="form-control form-control-sm" required>
          </div>
          <div class="d-grid mb-2">
            <button type="submit" class="btn btn-primary fw-semibold">{{ _('Invia richiesta') }}</button>
          </div>
          <div class="text-center">
            <a href="#" id="backToLogin" class="small link-like">⬅ {{ _('Torna al login') }}</a>
          </div>
        </form>
      </div>

      <hr class="soft-divider my-4">

      <!-- ===== REGISTRAZIONE ===== -->
      <div class="text-center">
        <span class="text-body-secondary">{{ _('Non hai un account?') }}</span>
        <button id="registerToggle" class="btn btn-ghost-primary ms-2">{{ _('Registrati') }}</button>
      </div>

      <div id="registerOptions" class="mt-3 d-grid gap-2 d-none">
        <a class="btn btn-outline-primary btn-sm" href="{{ url_for('auth.register_volunteer') }}">
          <i class="bi bi-person-heart me-1"></i>{{ _('Registrati come Volontario') }}
        </a>
        <a class="btn btn-outline-secondary btn-sm" href="{{ url_for('auth.register_association') }}">
          <i class="bi bi-people-fill me-1"></i>{{ _('Registrati come Associazione') }}
        </a>
      </div>

    </div>
  </div>
</div>
{% endblock %}

{% block scripts %}
<script>
document.addEventListener("DOMContentLoaded", function () {
  // toggle registrazione
  document.getElementById("registerToggle").onclick = e => {
    e.preventDefault();
    document.getElementById("registerOptions").classList.toggle("d-none");
  };

  // toggle reset password
  const loginForm = document.getElementById("loginForm");
  const resetForm = document.getElementById("resetForm");
  document.getElementById("forgotPasswordLink").onclick = e => {
    e.preventDefault(); loginForm.classList.add("d-none"); resetForm.classList.remove("d-none");
  };
  document.getElementById("backToLogin").onclick = e => {
    e.preventDefault(); resetForm.classList.add("d-none"); loginForm.classList.remove("d-none");
  };

  // mostra/nascondi password
  const pwd = document.getElementById("loginPassword");
  const btn = document.getElementById("togglePassword");
  btn.addEventListener("click", function(){
    if(pwd.type === "password"){ pwd.type = "text"; btn.innerHTML = '<i class="bi bi-eye-slash"></i>'; }
    else { pwd.type = "password"; btn.innerHTML = '<i class="bi bi-eye"></i>'; }
  });
});
</script>

<style>
  .login-card {
    max-width: 380px;  /* ✅ compatta */
    margin: auto;
    border-radius: 14px;
  }
  .brand-text { color: var(--color-primary, #019f95); }

  /* Divider */
  .soft-divider { border:0; border-top:1px solid #eef2f7; }

  /* Link stile ghost */
  .link-like { color: var(--color-primary, #019f95); text-decoration: none; }
  .link-like:hover { text-decoration: underline; }

  /* Pulsanti */
  .btn { border-radius: .6rem; font-size:.9rem; }
  .btn-primary { background: var(--color-primary, #019f95); border:none; }
  .btn-primary:hover { background: var(--color-primary-dark, #006b5f); }

  .btn-ghost-primary {
    border:1px solid var(--color-primary, #019f95);
    color: var(--color-primary, #019f95);
    background:#fff;
    font-weight:600;
  }
  .btn-ghost-primary:hover {
    background: var(--color-primary, #019f95);
    color:#fff;
  }

  /* Icon button piccola per occhiolino password */
  .icon-btn.ghost {
    border:1px solid #e6eaf0;
    background:#fff;
    color:#6b7280;
    padding:.25rem .5rem;
    border-radius:.5rem;
  }
  .icon-btn.ghost:hover { background:#f8fafc; color:#0d6efd; }
</style>
{% endblock %}
